import { Card } from "../ui/card";
import { Button } from "../ui/button";
import { CheckCircle2, LucideIcon } from "lucide-react";

interface VulnerabilityCardProps {
  id: number;
  title: string;
  description: string;
  severity: 'high' | 'medium' | 'low';
  icon: LucideIcon;
  isCompleted: boolean;
  progress?: number;
  onAction: () => void;
  actionLabel?: string;
}

export function VulnerabilityCard({
  id,
  title,
  description,
  severity,
  icon: Icon,
  isCompleted,
  progress = 0,
  onAction,
  actionLabel = 'Learn',
}: VulnerabilityCardProps) {
  const getSeverityConfig = (sev: string) => {
    switch (sev.toLowerCase()) {
      case 'high':
        return {
          bg: '#B50909',
          text: '#FFFFFF',
          label: 'High Risk',
          emoji: '⚠',
          ariaLabel: 'High risk vulnerability',
        };
      case 'medium':
        return {
          bg: '#FBBF24',
          text: '#000000',
          label: 'Medium Risk',
          emoji: '⚡',
          ariaLabel: 'Medium risk vulnerability',
        };
      case 'low':
        return {
          bg: '#2E8540',
          text: '#FFFFFF',
          label: 'Low Risk',
          emoji: '✓',
          ariaLabel: 'Low risk vulnerability',
        };
      default:
        return {
          bg: '#5A5A5A',
          text: '#FFFFFF',
          label: sev,
          emoji: '',
          ariaLabel: `${sev} risk vulnerability`,
        };
    }
  };

  const severityConfig = getSeverityConfig(severity);

  return (
    <Card
      className="relative overflow-hidden flex flex-col transition-all duration-300 bg-card border-[1.5px]"
      role="article"
      aria-label={`${title} - ${severityConfig.ariaLabel} - ${progress}% complete`}
      style={{
        borderColor: 'var(--border, #D9E1E2)',
        borderRadius: '12px',
        padding: '1.25rem 1rem',
        boxShadow: '0px 4px 10px rgba(0, 0, 0, 0.05)',
        height: '100%',
        minHeight: '320px',
        transform: 'translateY(0)',
      }}
      onMouseEnter={(e) => {
        e.currentTarget.style.transform = 'translateY(-4px)';
        e.currentTarget.style.boxShadow = '0px 6px 14px rgba(0, 0, 0, 0.08)';
        e.currentTarget.style.borderColor = '#2E8540';
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.transform = 'translateY(0)';
        e.currentTarget.style.boxShadow = '0px 4px 10px rgba(0, 0, 0, 0.05)';
        e.currentTarget.style.borderColor = 'var(--border, #D9E1E2)';
      }}
    >
      {/* Card Header - Top Section with Badges */}
      <div className="flex items-start justify-between mb-3">
        {/* Left side: Icon + Badges */}
        <div className="flex items-center gap-2 flex-1 min-w-0">
          {/* Icon Container */}
          <div
            className="flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center bg-success/10 dark:bg-teal/10"
            aria-hidden="true"
          >
            <Icon
              className="w-5 h-5 text-success dark:text-teal"
            />
          </div>

          {/* Module Tag */}
          <span
            className="text-xs px-2 py-1 rounded-md flex-shrink-0 bg-muted dark:bg-slate-700 text-primary dark:text-slate-200"
            style={{
              fontFamily: 'Public Sans, sans-serif',
              fontWeight: 600,
            }}
          >
            LLM{String(id).padStart(2, '0')}
          </span>

          {/* Risk Badge */}
          <span
            className="text-xs px-2 py-1 rounded-md flex-shrink-0"
            style={{
              backgroundColor: severityConfig.bg,
              color: severityConfig.text,
              fontFamily: 'Public Sans, sans-serif',
              fontWeight: 600,
            }}
            role="status"
            aria-label={severityConfig.ariaLabel}
          >
            <span aria-hidden="true">{severityConfig.emoji}</span> {severityConfig.label}
          </span>
        </div>

        {/* Right side: Completed Badge */}
        {isCompleted && (
          <div
            className="flex-shrink-0 ml-2"
            style={{
              animation: 'slideInFromRight 0.5s ease-out',
            }}
          >
            <div
              className="flex items-center gap-1 px-2.5 py-1 rounded-lg bg-success dark:bg-teal text-white"
              style={{
                fontFamily: 'Public Sans, sans-serif',
                fontWeight: 700,
                fontSize: '0.75rem',
              }}
            >
              <CheckCircle2 className="w-3.5 h-3.5" />
              <span>Completed</span>
            </div>
          </div>
        )}
      </div>

      {/* Main Card Body - Title */}
      <h3
        className="mb-2 line-clamp-2 text-foreground"
        style={{
          fontFamily: 'Public Sans, sans-serif',
          fontWeight: 700,
          fontSize: '1.1rem',
          lineHeight: '1.3',
          letterSpacing: '-0.01em',
        }}
      >
        {title}
      </h3>

      {/* Description */}
      <p
        className="text-sm mb-4 line-clamp-3 flex-1 text-muted-foreground"
        style={{
          fontFamily: 'Source Sans Pro, sans-serif',
          fontSize: '0.9rem',
          lineHeight: '1.5',
        }}
      >
        {description}
      </p>

      {/* Progress Section */}
      <div className="mb-4">
        <div className="flex items-center justify-between mb-1.5">
          <span
            className="text-xs uppercase tracking-wide text-muted-foreground dark:text-slate-400"
            style={{
              fontFamily: 'Public Sans, sans-serif',
              fontWeight: 600,
              fontSize: '0.7rem',
            }}
            id={`progress-label-${id}`}
          >
            Progress
          </span>
          <span
            className="text-xs text-success dark:text-teal"
            style={{
              fontFamily: 'Public Sans, sans-serif',
              fontWeight: 700,
            }}
            aria-live="polite"
            aria-atomic="true"
          >
            {progress}%
          </span>
        </div>
        
        {/* Progress Bar */}
        <div
          className="h-1.5 rounded-full overflow-hidden bg-muted dark:bg-slate-700"
          role="progressbar"
          aria-valuenow={progress}
          aria-valuemin={0}
          aria-valuemax={100}
          aria-labelledby={`progress-label-${id}`}
        >
          <div
            className="h-full transition-all duration-700 ease-out bg-success dark:bg-teal"
            style={{
              width: `${progress}%`,
              animation: 'progressSlide 1s ease-out',
            }}
          />
        </div>
      </div>

      {/* Action Button - Bottom Section */}
      <Button
        onClick={onAction}
        className={`w-full transition-all duration-200 ${
          isCompleted 
            ? 'bg-success/10 dark:bg-teal/10 text-success dark:text-teal border border-success dark:border-teal hover:bg-success/20 dark:hover:bg-teal/20' 
            : 'bg-success dark:bg-teal text-white hover:bg-success/90 dark:hover:bg-teal/90'
        }`}
        aria-label={`${actionLabel}: ${title}`}
        style={{
          height: '40px',
          borderRadius: '8px',
          fontFamily: 'Public Sans, sans-serif',
          fontWeight: 600,
          fontSize: '0.9rem',
        }}
        onMouseEnter={(e) => {
          e.currentTarget.style.transform = 'scale(1.02)';
        }}
        onMouseLeave={(e) => {
          e.currentTarget.style.transform = 'scale(1)';
        }}
      >
        {actionLabel}
      </Button>

      <style>{`
        @keyframes slideInFromRight {
          from {
            opacity: 0;
            transform: translateX(10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }

        @keyframes progressSlide {
          from {
            width: 0;
          }
        }

        @media (prefers-reduced-motion: reduce) {
          @keyframes slideInFromRight {
            from, to {
              opacity: 1;
              transform: translateX(0);
            }
          }
          @keyframes progressSlide {
            from, to {
              width: ${progress}%;
            }
          }
        }
      `}</style>
    </Card>
  );
}
